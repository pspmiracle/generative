{"version":3,"sources":["sketches/016_bloody_canvas_game/Bullet.js","sketches/016_bloody_canvas_game/Ship.js","utils/sound.js"],"names":["Bullet","options","Object","entries","key","option","this","color","random","pick","size","baseOptions","fieldSize","speed","initSpeedFactor","moveAngle","enemies","game","bX","x","bY","y","draw","destroy","Math","cos","sin","width","height","items","forEach","enemy","live","sqrt","explode","ctx","onBackground","context","backgroundContext","lineWidth","tailLength","min","max","beginPath","moveTo","lineTo","PI","stroke","fillStyle","arc","fill","bullets","remove","Ship","deadTime","document","addEventListener","handleKeyPress","bind","handleKeyUp","canvas","handleMouseMove","handleMouseDown","cursorX","cursorY","moveDirection","up","right","down","left","gunAngle","running","ship","time","playSound","dead","i","bullet","gunTipCoord","range","add","a","e","fire","movementX","movementY","atan2","code","moveDiff","fromX","fromY","toX","toY","audioCtx","window","AudioContext","webkitAudioContext","frequency","type","volume","o","createOscillator","g","createGain","connect","destination","value","start","gain","exponentialRampToValueAtTime","currentTime","setTimeout","stop","disconnect"],"mappings":"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","file":"static/js/55.5a2c866a.chunk.js","sourcesContent":["import random from 'canvas-sketch-util/random';\n\nexport default class Bullet {\n  constructor(options) {\n    for (const [key, option] of Object.entries(options)) {\n      this[key] = option;\n    }\n\n    this.color = random.pick(['#4b86b4', '#adcbe3', '#63ace5']);\n    this.size = this.baseOptions.fieldSize / 100;\n    this.speed = (this.baseOptions.fieldSize / 100) * this.initSpeedFactor;\n  }\n\n  update() {\n    const {\n      moveAngle,\n      game: { enemies },\n    } = this;\n\n    this.bX = this.x;\n    this.bY = this.y;\n\n    this.speed += -0.1;\n\n    if (this.speed <= 0) {\n      this.draw(true);\n      this.destroy();\n    } else {\n      this.x += Math.cos(moveAngle) * this.speed;\n      this.y += Math.sin(moveAngle) * this.speed;\n    }\n\n    if (\n      this.x < -100 ||\n      this.x > this.baseOptions.width + 100 ||\n      this.y < -100 ||\n      this.y > this.baseOptions.height + 100\n    ) {\n      this.destroy();\n    }\n\n    enemies.items.forEach(enemy => {\n      if (enemy.live) {\n        const distance = Math.sqrt((this.x - enemy.x) ** 2 + (this.y - enemy.y) ** 2);\n        if (distance < enemy.size) {\n          enemy.explode();\n          this.destroy();\n        }\n      }\n    });\n  }\n\n  draw(onBackground = false) {\n    const {\n      baseOptions: { context, backgroundContext },\n      x,\n      y,\n    } = this;\n\n    let ctx;\n    if (onBackground) {\n      ctx = backgroundContext;\n    } else {\n      ctx = context;\n    }\n\n    ctx.lineWidth = this.size / 10;\n\n    // Tail\n    const tailLength = Math.min(this.size * Math.max(this.speed, 1), this.size * 5);\n    ctx.beginPath();\n    ctx.moveTo(this.x, this.y);\n    ctx.lineTo(\n      this.x + Math.cos(this.moveAngle - Math.PI) * tailLength,\n      this.y + Math.sin(this.moveAngle - Math.PI) * tailLength,\n    );\n    ctx.stroke();\n\n    // Body\n    ctx.fillStyle = this.color;\n    ctx.beginPath();\n    ctx.arc(x, y, this.size / 2, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.stroke();\n  }\n\n  destroy() {\n    this.game.bullets.remove(this);\n  }\n}\n","import { playSound } from '@/utils/sound';\nimport random from 'canvas-sketch-util/random';\nimport Bullet from './Bullet';\n\nexport default class Ship {\n  constructor(options) {\n    for (const [key, option] of Object.entries(options)) {\n      this[key] = option;\n    }\n\n    this.deadTime = 0;\n\n    this.size = this.baseOptions.fieldSize / 50;\n\n    document.addEventListener('keydown', this.handleKeyPress.bind(this));\n    document.addEventListener('keyup', this.handleKeyUp.bind(this));\n\n    this.baseOptions.canvas.addEventListener('mousemove', this.handleMouseMove.bind(this));\n    this.baseOptions.canvas.addEventListener('mousedown', this.handleMouseDown.bind(this));\n\n    this.cursorX = 0;\n    this.cursorY = 0;\n\n    this.moveDirection = {\n      up: false,\n      right: false,\n      down: false,\n      left: false,\n    };\n    this.gunAngle = Math.PI;\n  }\n\n  fire() {\n    if (!this.game.running) {\n      this.game.ship.deadTime = this.game.time;\n      this.game.running = true;\n      playSound(random.pick([100]), 'sine', 1, 0.5);\n      return;\n    }\n\n    if (this.dead) {\n      return;\n    }\n\n    const { baseOptions, game } = this;\n    // playSound(random.pick([698.5, 784.0, 880.0]), 'sawtooth', 0.08);\n    playSound(random.pick([311.1, 370.0, 415.3]), 'sawtooth', 0.1, 0.5);\n    playSound(random.pick([155.6, 185.0, 207.7]), 'sine', 0.2, 0.5);\n\n    for (let i = 0; i < 8; i += 1) {\n      const bullet = new Bullet({\n        baseOptions,\n        game,\n        x: this.gunTipCoord[0],\n        y: this.gunTipCoord[1],\n        moveAngle: this.gunAngle + random.range(-Math.PI / 32, Math.PI / 32),\n        initSpeedFactor: random.range(0.8, 1.2),\n      });\n      game.bullets.add(bullet);\n    }\n  }\n\n  explode() {\n    playSound(87.31, 'triangle', 0.1);\n\n    const { x, y, baseOptions, game } = this;\n    this.dead = true;\n    this.deadTime = game.time;\n\n    for (let a = -Math.PI; a < Math.PI; a += Math.PI / 50) {\n      const bullet = new Bullet({\n        baseOptions,\n        game,\n        x,\n        y,\n        moveAngle: a,\n        initSpeedFactor: random.range(0.8, 1.2),\n      });\n      game.bullets.add(bullet);\n    }\n  }\n\n  handleMouseDown(e) {\n    this.fire();\n  }\n\n  handleMouseMove(e) {\n    const { movementX, movementY } = e;\n\n    this.cursorX += movementX;\n    this.cursorY += movementY;\n\n    this.gunAngle = Math.atan2(this.cursorY, this.cursorX);\n\n    this.cursorX = 200 * Math.cos(this.gunAngle);\n    this.cursorY = 200 * Math.sin(this.gunAngle);\n  }\n\n  handleKeyPress(e) {\n    switch (e.code) {\n      case 'ArrowUp':\n      case 'KeyW': {\n        this.moveDirection.up = true;\n        break;\n      }\n      case 'ArrowRight':\n      case 'KeyD': {\n        this.moveDirection.right = true;\n        break;\n      }\n      case 'ArrowDown':\n      case 'KeyS': {\n        this.moveDirection.down = true;\n        break;\n      }\n      case 'ArrowLeft':\n      case 'KeyA': {\n        this.moveDirection.left = true;\n        break;\n      }\n      default:\n    }\n  }\n\n  handleKeyUp(e) {\n    switch (e.code) {\n      case 'ArrowUp':\n      case 'KeyW': {\n        this.moveDirection.up = false;\n        break;\n      }\n      case 'ArrowRight':\n      case 'KeyD': {\n        this.moveDirection.right = false;\n        break;\n      }\n      case 'ArrowDown':\n      case 'KeyS': {\n        this.moveDirection.down = false;\n        break;\n      }\n      case 'ArrowLeft':\n      case 'KeyA': {\n        this.moveDirection.left = false;\n        break;\n      }\n      default:\n    }\n  }\n\n  update() {\n    if (this.dead) {\n      if (this.game.time - this.deadTime > 1) {\n        this.dead = false;\n      }\n      return;\n    }\n    const moveDiff = this.baseOptions.fieldSize / 300;\n    if (this.moveDirection.up) {\n      this.y += -moveDiff;\n    }\n    if (this.moveDirection.right) {\n      this.x += moveDiff;\n    }\n    if (this.moveDirection.down) {\n      this.y += moveDiff;\n    }\n    if (this.moveDirection.left) {\n      this.x -= moveDiff;\n    }\n\n    this.x = Math.max(Math.min(this.baseOptions.width, this.x), 0);\n    this.y = Math.max(Math.min(this.baseOptions.height, this.y), 0);\n  }\n\n  draw() {\n    const {\n      baseOptions: { context },\n      x,\n      y,\n      gunAngle,\n    } = this;\n\n    if (this.dead) {\n      return;\n    }\n\n    // Body\n    context.fillStyle = `#96ceb4`;\n    context.lineWidth = this.size / 10;\n    context.beginPath();\n    context.arc(x, y, this.size / 2, 0, Math.PI * 2);\n    context.fill();\n    context.stroke();\n\n    // Gun\n    context.beginPath();\n    const fromX = (Math.cos(gunAngle) * this.size) / 2;\n    const fromY = (Math.sin(gunAngle) * this.size) / 2;\n\n    const toX = Math.cos(gunAngle) * this.size * 1.5;\n    const toY = Math.sin(gunAngle) * this.size * 1.5;\n\n    this.gunTipCoord = [x + toX, y + toY];\n\n    context.moveTo(x + fromX, y + fromY);\n    context.lineTo(x + toX, y + toY);\n    context.stroke();\n  }\n}\n","const audioCtx = new (window.AudioContext || window.webkitAudioContext)();\n\nexport function playSound(frequency, type, x, volume = 1) {\n  const o = audioCtx.createOscillator();\n  const g = audioCtx.createGain();\n  o.connect(g);\n  o.type = type;\n  g.connect(audioCtx.destination);\n  o.frequency.value = frequency;\n  o.start();\n  g.gain.value = volume;\n  g.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + x);\n\n  setTimeout(() => {\n    o.stop();\n    o.disconnect();\n  }, (x + 0.5) * 1000);\n}\n"],"sourceRoot":""}